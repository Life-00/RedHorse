# 교대 근무 유형 일관성 개선

## 1. 개요

교대 근무자를 위한 웰니스 앱에서 온보딩 단계에서 선택한 근무 유형(2교대/3교대/고정야간/불규칙)과 실제 근무표에 표시되는 교대 타입 간의 불일치 문제를 해결합니다.

## 2. 문제 정의

### 2.1 문제점 1: 2교대 선택 시 근무표 타입 불일치

**현재 상황:**
- 사용자가 온보딩에서 "2교대"를 선택
- 근무표에는 "주간 / 야간 / 초저녁 / 휴무" 4가지 타입이 표시됨
- "초저녁" 근무는 2교대에 존재하지 않는 타입

**문제 원인:**
- 프론트엔드: `ScheduleRegisterModal.tsx`에서 `workType`을 받지만 필터링 로직이 불완전
- 프론트엔드: `SchedulePage.tsx`의 `SHIFT_CONFIG`에 모든 타입이 하드코딩됨
- 백엔드: 스케줄 생성 시 `work_type` 검증 없음

**요구사항:**
- 2교대 선택 시: 주간(day) / 야간(night) / 휴무(off)만 허용
- 3교대 선택 시: 주간(day) / 초저녁(evening) / 야간(night) / 휴무(off) 허용
- 고정 야간 선택 시: 야간(night) / 휴무(off)만 허용
- 불규칙 선택 시: 모든 타입 허용

### 2.2 문제점 2: 홈 화면 오늘 근무 정보 표시 오류

**현재 상황:**
- 홈 화면의 "오늘의 스케줄" 정보가 실제 근무표 데이터와 불일치
- 시간 포맷에 초 단위가 포함됨 (예: "09:00:00 ~ 18:00:00")
- 날짜 정보가 부정확

**문제 원인:**
- `HomeDashboard.tsx`의 `getScheduleInfo()` 함수가 DB에서 가져온 시간을 그대로 표시
- 시간 포맷팅 로직 부재

**요구사항:**
- 오늘 날짜: 실제 시스템 날짜 기준으로 정확히 표시
- 오늘의 근무 타입: DB의 `schedules` 테이블에서 가져온 실제 데이터 표시
- 시간 포맷: HH:MM 형식만 표시 (초 제거)
  - 예: "09:00 ~ 18:00", "22:00 ~ 07:00"

## 3. 사용자 스토리

### 3.1 2교대 근무자의 근무표 등록

**As a** 2교대 근무자  
**I want to** 근무표에서 주간/야간/휴무만 선택할 수 있기를  
**So that** 내 실제 근무 형태와 일치하는 정확한 스케줄을 관리할 수 있다

**인수 기준:**
1. 온보딩에서 "2교대"를 선택한 사용자
2. 근무표 등록 모달에서 "주간", "야간", "휴무" 버튼만 표시됨
3. "초저녁" 버튼은 표시되지 않음
4. 월간 달력 범례에도 "초저녁"이 표시되지 않음
5. 주간 상세 카드에도 "초저녁" 타입이 나타나지 않음

### 3.2 3교대 근무자의 근무표 등록

**As a** 3교대 근무자  
**I want to** 근무표에서 주간/초저녁/야간/휴무를 모두 선택할 수 있기를  
**So that** 3교대 순환 근무를 정확히 기록할 수 있다

**인수 기준:**
1. 온보딩에서 "3교대"를 선택한 사용자
2. 근무표 등록 모달에서 4가지 타입 모두 표시됨
3. 월간 달력 범례에 4가지 타입 모두 표시됨

### 3.3 홈 화면에서 오늘 근무 정보 확인

**As a** 교대 근무자  
**I want to** 홈 화면에서 오늘의 정확한 근무 정보를 보고 싶다  
**So that** 오늘 내가 언제 근무하는지 한눈에 파악할 수 있다

**인수 기준:**
1. 홈 화면 상단에 오늘 날짜가 정확히 표시됨
2. "오늘의 스케줄" 카드에 실제 DB 데이터가 표시됨
3. 근무 시간이 "HH:MM ~ HH:MM" 형식으로 표시됨 (초 없음)
4. 근무표 페이지의 데이터와 완전히 일치함

## 4. 기술적 제약사항

### 4.1 데이터 모델

**users 테이블:**
```sql
work_type VARCHAR(50) -- '2shift', '3shift', 'fixed_night', 'irregular'
```

**schedules 테이블:**
```sql
shift_type VARCHAR(20) -- 'day', 'evening', 'night', 'off'
start_time TIME
end_time TIME
```

### 4.2 근무 유형별 허용 교대 타입 매핑

| work_type | 허용되는 shift_type |
|-----------|-------------------|
| 2shift | day, night, off |
| 3shift | day, evening, night, off |
| fixed_night | night, off |
| irregular | day, evening, night, off |

### 4.3 기본 근무 시간

| shift_type | start_time | end_time |
|-----------|-----------|----------|
| day | 08:00 | 17:00 |
| evening | 14:00 | 23:00 |
| night | 22:00 | 07:00 |
| off | NULL | NULL |

## 5. 비기능 요구사항

### 5.1 성능
- 근무표 조회 응답 시간: 1초 이내
- 홈 화면 로딩 시간: 2초 이내

### 5.2 사용성
- 근무 유형 변경 시 기존 스케줄 데이터는 유지
- 잘못된 타입의 기존 데이터는 "휴무"로 자동 변환

### 5.3 데이터 무결성
- 온보딩 `work_type`이 모든 근무 관련 로직의 단일 진실 공급원(Single Source of Truth)
- 프론트엔드 임시 처리 금지 - 백엔드에서 검증 및 필터링

## 6. 범위 외 항목

- 근무 유형 자체를 변경하는 기능 (프로필 설정에서 별도 구현)
- 과거 스케줄 데이터 마이그레이션
- 알림 기능
- 다국어 지원
